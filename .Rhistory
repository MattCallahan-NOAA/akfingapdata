end_year=2024)
# Get Western Aleutian lincod agecomp and biomass from 2010 onward
get_gap_agecomp(survey_definition_id = 47,
area_id = 99903,
species_code = 21371,
start_year=1990,
end_year=2024)
# Get Western Aleutian lincod agecomp and biomass from 2010 onward
get_gap_agecomp(survey_definition_id = 47,
area_id = 99903,
species_code = 21371,
start_year=1980,
end_year=2024)
# Get Western Aleutian lincod agecomp and biomass from 2010 onward
get_gap_agecomp(survey_definition_id = 47,
area_id = 99903,
species_code = 21371,
start_year=1990,
end_year=2024)
token<-create_token("Callahan_token.txt")
# Get Western Aleutian lincod agecomp and biomass from 2010 onward
get_gap_agecomp(survey_definition_id = 47,
area_id = 99903,
species_code = 21371,
start_year=1990,
end_year=2024)
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_agecomp?start_year=1990&end_year=3000&survey_definition_id=947&species_code=21371&area_id=99903"
httr::content(
httr::GET(url=url,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_agecomp?start_year=2003&end_year=3000&survey_definition_id=947&species_code=21371&area_id=99903"
httr::content(
httr::GET(url=url,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_agecomp?start_year=2003&end_year=3000&survey_definition_id=47&species_code=21371&area_id=99903"
httr::content(
httr::GET(url=url,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_agecomp?start_year=1990&end_year=3000&survey_definition_id=47&species_code=21371&area_id=99903"
httr::GET(url=url, query, add_headers(Authorization = token))
httr::GET(url=url,  add_headers(Authorization = token))
httr::content(
httr::GET(url=url,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
#gecomp troubleshooting
survey_definition_id=47
area_id=99903
species_code=21370
start_year=1990
end_year=3000
# paste(... collapse=",") puts commas between vector elements
area_id <- paste(area_id, collapse = ",")
species_code <- paste(species_code, collapse = ",")
survey_definition_id<-paste(survey_definition_id, collapse = ",")
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
library(akfingapdata)
# Get Western Aleutian lincod agecomp and biomass from 2010 onward
get_gap_agecomp(survey_definition_id = 47,
area_id = 99903,
species_code = 21371,
start_year=1990,
end_year=2024)
library(akfingapdata)
# find species codes for shortraker rockfish
taxa %>% filter(grepl("shortraker", tolower(common_name)))
# look for the western Gulf
# 805
stratum %>%
filter(survey=="GOA",
type=="REGULATORY AREA",
grepl("western", tolower(area_name))
)
# Get Western Aleutian lincod agecomp and biomass from 2010 onward
ages<-get_gap_agecomp(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2024)
token<-create_token("Callahan_token.txt")
# Get Western GOA shortraker, agecomp, biomass from 2010 onward
goasr_ages<-get_gap_agecomp(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
goasr_biomass<-get_gap_biomass(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
goasr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
head(goasr_sizecomp)
# Get catch, cpue, length frequency, and specimens at a haul level for Western GOA shortraker
goasr_catch<-get_gap_catch(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
goasr_cpue<-get_gap_cpue(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
# No agecomp for shortraker at that area, run gulfwide instead.
head(get_gap_agecomp(survey_definition_id = 47,
area_id = 99903,
species_code = 30576,
start_year=1990,
end_year=2023))
# Get catch, cpue, length frequency, and specimens at a haul level for Western GOA shortraker
goasr_catch<-get_gap_catch(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
goasr_cpue<-get_gap_cpue(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
goasr_lengths<-get_gap_lengths(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
goasr_specimen<-get_gap_specimen(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
# Get rougheye and shortraker specimens for the WGOA
taxa %>% filter(grepl("rougheye", common_name))
goa_resr_specimen<-get_gap_specimen(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
token<-create_token("Callahan_token.txt")
goa_resr_specimen<-get_gap_specimen(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
species_code = c(30576, 30051),
species_code = c(30576, 30051)
# paste(... collapse=",") puts commas between vector elements
area_id <- paste(area_id, collapse = ",")
species_code <- paste(species_code, collapse = ",")
survey_definition_id<-paste(survey_definition_id, collapse = ",")
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_specimen?"
httr::content(
httr::GET(url=url, query=query,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
httr::GET(url=url, query=query,
add_headers(Authorization = token))
# paste(... collapse=",") puts commas between vector elements
area_id <- paste(area_id, collapse = ",")
species_code <- paste(species_code, collapse = ",")
survey_definition_id<-paste(survey_definition_id, collapse = ",")
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_specimen?"
httr::GET(url=url, query=query,
add_headers(Authorization = token))
species_code = c(30576,30051)
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
httr::GET(url=url, query=query,
add_headers(Authorization = token))
species_code = c("30576","30051")
species_code <- paste(species_code, collapse = ",")
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
httr::GET(url=url, query=query,
add_headers(Authorization = token))
# paste(... collapse=",") puts commas between vector elements
area_id <- paste0(area_id, collapse = ",")
species_code <- paste0(species_code, collapse = ",")
survey_definition_id<-paste0(survey_definition_id, collapse = ",")
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_specimen?"
httr::GET(url=url, query=query,
add_headers(Authorization = token))
species_code = c(30576,30051)
species_code <- paste0(species_code, collapse = ",")
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
View(query)
url <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_specimen?"
httr::GET(url=url, query=query,
add_headers(Authorization = token))
httr::content(
httr::GET(url=url, query=query,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
goa_resr_biomass<-get_gap_biomass(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
token<-create_token("Callahan_token.txt")
goa_resr_biomass<-get_gap_biomass(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
#chatGPT solution to paste issue
library(httr)
library(purrr)
base_url <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_specimen?"
url<-modify_url(base_url, query=list(survey_definition_id=survey_definition_id,
area_id=area_id,
species_code=species_code,
start_year=start_year,
end_year=end_year))
url
species_code = c(30576,30051)
species_code <- paste(species_code, collapse = ",")
query <- list(survey_definition_id<-survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
query <- list(survey_definition_id=survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url<-modify_url(base_url, query=list(survey_definition_id=survey_definition_id,
area_id=area_id,
species_code=species_code,
start_year=start_year,
end_year=end_year))
url
species_code = c(30576,30051)
query <- list(survey_definition_id=survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url<-modify_url(base_url, query=list(survey_definition_id=survey_definition_id,
area_id=area_id,
species_code=species_code,
start_year=start_year,
end_year=end_year))
species_code = list(30576,30051)
query <- list(survey_definition_id=survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url<-modify_url(base_url, query=list(survey_definition_id=survey_definition_id,
area_id=area_id,
species_code=species_code,
start_year=start_year,
end_year=end_year))
species_code <- paste(species_code, collapse = ",")
query <- list(survey_definition_id=survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url<-modify_url(base_url, query=list(survey_definition_id=survey_definition_id,
area_id=area_id,
species_code=species_code,
start_year=start_year,
end_year=end_year))
url
print(query)
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_agecomp?start_year=1990&end_year=3000&survey_definition_id=47&species_code=30576,30051&area_id=99903"
token<-create_token("Callahan_token.txt")
httr::GET(url=url,  add_headers(Authorization = token))
httr::content(
httr::GET(url=url,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
get_gap_biomass(area_id=4)
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47&species_code=30576,30051&area_id=99903"
httr::GET(url=url,  add_headers(Authorization = token))
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47&species_code=30576%2C30051&area_id=99903"
httr::GET(url=url,  add_headers(Authorization = token))
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47&species_code=30051&area_id=99903"
httr::GET(url=url,  add_headers(Authorization = token))
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47,98&species_code=30051&area_id=99903"
httr::GET(url=url,  add_headers(Authorization = token))
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47&species_code=30051&area_id=99903"
httr::GET(url=url,  add_headers(Authorization = token))
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47&species_code=300576,30051&area_id=99903"
httr::GET(url=url,  add_headers(Authorization = token))
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47&species_code=300576,30051&area_id=805"
httr::GET(url=url,  add_headers(Authorization = token))
url<-"https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?start_year=1990&end_year=3000&survey_definition_id=47&species_code=300576,30051&area_id=805"
httr::GET(url=url,  add_headers(Authorization = token))
httr::content(
httr::GET(url=url,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
goa_resr_biomass<-get_gap_biomass(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
head(goa_resr_biomass)
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
get_gap_sizecomp<-function(survey_definition_id=98, area_id=1, species_code=21740, start_year=1990, end_year=3000) {
# paste(... collapse=",") puts commas between vector elements
area_id <- paste(area_id, collapse = ",")
species_code <- paste(species_code, collapse = ",")
survey_definition_id<-paste(survey_definition_id, collapse = ",")
query <- list(survey_definition_id=survey_definition_id, area_id=area_id, species_code=species_code, start_year=start_year, end_year=end_year)
url <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_sizecomp?"
httr::content(
httr::GET(url=url, query=query,
add_headers(Authorization = token)),
type = "application/json") %>%
# convert to data frame
dplyr::bind_rows() %>%
dplyr::rename_with(tolower)
}
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
goa_resr_biomass<-get_gap_biomass(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = 30051,
#species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
gap_haul<-get_gap_haul()
token<-create_token("Callahan_token.txt")
gap_haul<-get_gap_haul()
gap_cruise<-get_gap_cruises()
token<-create_token("Callahan_token.txt")
goa_resr_biomass<-get_gap_biomass(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
head(goa_resr_biomass)
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = 30051,
#species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
goa_resr_sizecomp<-get_gap_sizecomp(survey_definition_id = 47,
area_id = 805,
species_code = c(30576, 30051),
start_year=1990,
end_year=2023)
split_fractions<-get_gap_split_fractions()
library(akfingapdata)
library(tidyverse)
library(httr)
library(jsonlite)
get_gap_biomass()
create_token()
create_token("Callahan_token.txt")
get_gap_biomass()
get_gap_biomass()
token<-create_token("Callahan_token.txt")
get_gap_biomass()
get_gap_biomass()
metadata<-get_gap_metadata_column()
metadata
View(metadata)
View(metadata)
# download species_code
taxa<- get_gap_taxonomics()
# find species codes for shortraker rockfish
taxa %>% filter(grepl("shortraker", tolower(common_name)))
# find species codes for shortraker rockfish
taxa %>% filter(grepl("sablefish", tolower(common_name)))
# No agecomp data for this area/species
goasr_ages<-get_gap_agecomp(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
View(goasr_ages)
goasr_biomass<-get_gap_biomass(survey_definition_id = 47,
area_id = 805,
species_code = 30576,
start_year=1990,
end_year=2023)
View(goasr_biomass)
check_vector <- function(x) {
if(all(is.na(x) | x == 0)) {
print("YAY")
} else {
print("OH NO")
}
}
vector_1 <- c(0, 0, 0, 0)
vector_2 <- c(1, 0, 0, NA)
vector_3 <- c(0, 0, NA, 0)
check_vector(vector_1)
check_vector(vector_2)
check_vector(vector_3)
check_vector <- function(x) {
if(all(x == 0)) {
print("YAY")
} else {
print("OH NO")
}
}
check_vector(vector_3)
check_vector(vector_1)
library(akfingapdata)
library(magrittr)
create_token("Callahan_token")
token<-create_token("Callahan_token.txt")
get_gap_length()
library(tidyverse)
library(httr)
library(jsonlite)
get_gap_length()
get_gap_cruise()
get_gap_biomass()
token<-create_token("Callahan_token.txt")
token<-create_token("cheryll_token.txt")
token<-create_token("cheryl_token.txt")
get_gap_biomass()
get_gap_length()
get_gap_cruise()
get_gap_taxonomic_classification()
token<-create_token("Callahan_token.txt")
url <- "https://apex.psmfc.org/akfin/data_marts/akmp/gap_biomass?"
httr::GET(url=url,
add_headers(Authorization = token))
url <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?"
httr::GET(url=url,
add_headers(Authorization = token))
httr::GET(url=url,
add_headers(Authorization = token))
httr::GET(url=url,
add_headers(Authorization = token))
url1 <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?"
url2 <- "https://apex.psmfc.org/akfin/data_marts/akm/abl_tag_recovery_report?tag_num=1"
httr::GET(url=url2,
add_headers(Authorization = token))
httr::GET(url=url1,
add_headers(Authorization = token))
# Secret string text file needs to be in your working R directory
secret <- jsonlite::base64_enc( readChar("cheryl_token.txt",nchars=1e6) )
# Get token from API
req <- httr::POST("https://apex.psmfc.org/akfin/data_marts/oauth/token",
httr::add_headers(
"Authorization" = paste("Basic", gsub("\n", "", secret)),
"Content-Type" = "application/x-www-form-urlencoded;charset=UTF-8"
),
body = "grant_type=client_credentials"
);
#  Create authentication error message
httr::stop_for_status(req, "Something broke.")
token <- paste("Bearer", httr::content(req)$access_token)
httr::GET(url=url1,
add_headers(Authorization = token))
httr::GET(url=url2,
add_headers(Authorization = token))
# Secret string text file needs to be in your working R directory
secret <- jsonlite::base64_enc( readChar("Callahan_token.txt",nchars=1e6) )
# Get token from API
req <- httr::POST("https://apex.psmfc.org/akfin/data_marts/oauth/token",
httr::add_headers(
"Authorization" = paste("Basic", gsub("\n", "", secret)),
"Content-Type" = "application/x-www-form-urlencoded;charset=UTF-8"
),
body = "grant_type=client_credentials"
);
#  Create authentication error message
httr::stop_for_status(req, "Something broke.")
token <- paste("Bearer", httr::content(req)$access_token)
url1 <- "https://apex.psmfc.org/akfin/data_marts/gap_products/gap_biomass?"
httr::GET(url=url1,
add_headers(Authorization = token))
